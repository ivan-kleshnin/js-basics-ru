# Синтаксические единицы

Для изучения JS важно уметь различать основные синтаксические единицы
(или примитивы): **инструкции**, **декларации**, **выражения**,
**операторы**, **блоки**.

#### Ключевое слово

Зарезервированная комбинация символов имеющая определённое значение.
Обычно, ключевое слово используется для определения Инструкции, Декларации или Оператора.

Примеры: `var`, `let`, `if`, `while`, `for`, `do`

Полный список ключевых слов приводится далее. Иногда, *ключевые* и *зарезервированные*
слова рассматриваются как отдельные понятия. В данном тексте, однако, эти термины
используются как синонимы.

#### Инструкция

Особая синтаксическая единица, предназначенная для сайд-эффектов
(на уровне интепретатора) и не имеющая (не возвращающая) значения.
Инструкции определяются с помощью ключевых слов.

Примеры:
* `if (false)` – условие
* `while (true)` – цикл
* `for (let i = 0; i < n; i++)` – цикл
* `break` – выход из цикла
* `return` – выход из функции

Большинство инструкций задаётся ключевым словом.
Одним из исключений является присваивание, инициируемое оператором `=`.

Большинство инструкций сопровождается т.н. Блоком (см. ниже).

Инструкции не являются сущностями первого класса (**1.3**) и не композируются.
Однако, если инструкция сопровождается блоком (в т.ч. имплицитным), то последующие инструкции
могут находится в теле блока.

#### Декларация

Особая синтаксическая единица, которая обрабатывается до выполнения кода
(в статике). Декларации часто содержат инструкции как составную часть.
Декларации определяются с помощью ключевых слов.

Примеры:
* `var x = 2`
* `let y = "foo"`
* `const z = [0, 0, 0]`
* `import "something"`
* `function test () {/*...*/}` (зависит от контекста)

Декларации не являются сущностями первого класса и не композируются.
Впрочем, для части из них имеется синтаксический сахар:

```js
let x = 1, y = 2
// преобразуется в
let x = 1; let y = 2;
```

#### Выражение

Любая синтаксическая единица содержащая значение или вычисляемая до него.

Примеры: `x`, `2 + 2`, `console.log(x)`, `x > y ? x : y` ...

`console.log` является вырожденным случаем выражения (всегда возвращает `undefined`), которое можно было бы заменить на инструкцию.
См. пример `print x` vs `print(x)` в Python.

В JS выражения всегда синтаксически (статически) композируются, однако
эта композиция не всегда имеет логический смысл. Следующее выражение
является синтаксически корректным, но не несёт никакой семантики:

```js
1 + console.log(2) * true
```

Выражения являются сущностями первого класса и композируются.

#### Оператор

Оператор является эквивалентом функции с фиксированным числом аргументов.
Причинами реализации функции в виде оператора может быть использование
(неалфавитных) символов, инфиксной нотации (арифметика), необходимость
уникальных сайд-эффектов (присваивание), особой парадигмы вычислений
(условия) и т.п. Как и функции, операторы образуют выражения.

Операторы могут быть префиксными (унарными) или инфиксными (бинарными)
за исключением т.н. "условного оператора", являющегося тернарным.

Примеры: `=`, `==`, `&`, `&&`, `+`, `*`, `!`, `typeof`, `delete`, `in`, `_ ? _ : _`

В отличие от функций, операторы, не являются сущностями
первого класса. Однако выражения, построенные с их помощью,
являются обычными выражениями и композируются обычным образом.

#### Блоки

Блоки задаются фигурными скобками: `{ блок }` и объединяют несколько инструкций.
В отличие от Ruby, блоки в JS не связаны с вызовами функций, а
предназначены для группировки инструкций и ограничения видимости
переменных.

```js
let word1 = "Hello"

// Блок
{
  let word2 = "blocks!"
  let sentence = word1 + " "+ word2
  console.log(sentence) // ⎙ Hello blocks!
}

// Инструкция плюс блок:
if (whatever) {
  let word2 = "blocks!"
  let sentence = word1 + " "+ word2
  console.log(sentence) // ⎙ Hello blocks!
}
```

Блоки могут влиять на область видимости переменных.

#### Точки с запятыми

Точки с запятыми в JS являются необязательными. Правила очень просты:

1. Не начинать строку с квадратной скобки `[`
2. Не начинать строку с круглой скобки `(`
3. Не начинать строку с обратной кавычки / backtick

По необходимости, любое из правил можно нарушить в частном порядке,
проставив предварительную точку с запятой:

```js
// След. точка с запятой является обязательной
;(function() {
  console.log("IIFE")
})()
```

Большинство современных стилистических гайдов рекомендуют избегать
точек с запятыми для улучшения читабельности кода.

---

Некоторые синтаксические конструкции могут выглядеть идентично,
но вести себя по разному, что будет объясняться их категорией:

```js
// foo – декларация
function foo() {}
console.log(foo) // [Function: foo]

// bar – выражение
test(function bar() {})
console.log(bar) // ReferenceError: bar is not defined
```

Далее по тексту мы будем характеризовать ту или иную конструкцию как
Декларацию, Выражение, Оператор или Инструкцию.
Избегая, таким образом, дополнительных и дублирующих объяснений.

> Вопрос: валиден ли код `y = let x`?
> Ответ: нет, поскольку `let` образует декларацию, а не выражение.

> Вопрос: можно ли передать конструкцию `if` в качестве аргумента функции?
> Ответ: нет, потому что `if` образует инструкцию, а не выражение.

> Вопрос: можно ли передать выражение с тернарным оператором в качестве аргумента функции?
> Ответ: да, потому что функции принимают выражения в качестве аргументов.

> Вопрос: Почему `min <= x <= max` не работает?! В Питоне работало!!!
> Ответ: композиция данных операторов не имеет семантики. Рассмотрим вариант, где `min`, `x` и `max`
относятся к типу `number`:

> ```js
// Ассоциативность влево:
min <= x <= max
(min <= x) <= max
typeof (min <= x) // "boolean"
typeof max        // "number"
// Сравнение boolean с number не имеет смысла
```

> ```js
// Ассоциативность вправо:
min <= x <= max
min <= (x <= max)
typeof min        // "number"
typeof (x <= max) // "boolean"
// Сравнение number с boolean не имеет смысла
```

> Вывод: в Python, выражение вида `x <= y <= z` работает на хаках (синтаксическом сахаре) парсера.

Строго говоря, разница между Выражением и Инструкцией определяется на уровне интерпретатора, а не синтаксиса
и часто определяется контекстом. Так `x = 2` является выражением, а `x = 2;` – инструкцией (из-за наличия точки с запятой в конце).
Мы не будем углубляться в эти вопросы больше, чем требуется в учебных целях.

Интересующимся, предлагается поэкспериментировать с [демо-парсером](http://esprima.org/demo/parse.html).
